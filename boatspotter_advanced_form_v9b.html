<!DOCTYPE html><html lang='sv'><head><meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<title>Boatspotter â€“ FormulÃ¤r V8</title>
<style>body{font-family:sans-serif;margin:20px;max-width:800px}
.section{margin-bottom:30px;padding-top:20px;border-top:2px solid #999}
label{display:block;margin-top:10px;font-weight:bold}
input,select{padding:5px;margin-top:5px}
.row{display:flex;align-items:center;margin-top:5px}.row button{margin-right:10px}
.important{border:2px solid red;background:#ffe5e5}</style>
</head><body><h2>Boatspotter â€“ Avancerat formulÃ¤r V8</h2><form id='boatForm'>
<div class='section'><h3>Admin</h3>
<div style='display:none'>
<input type='text' id='Report_datetime' name='Report_datetime' readonly>
</div>
<div>
<label for='Image'>Image</label>
<input type='file' class='important' id='Image' name='Image' accept='image/*'>
</div>
<div class='section'><h3>CPA</h3>
<div>
<label for='TCPA_datetime'>TCPA datetime</label>
<div class='row'><button type='button' onclick='handleButton("TCPA_datetime")'>SÃ¤tt CPA-tid</button>
<input type='text' class='important' id='TCPA_datetime' name='TCPA_datetime'></div>
</div>
<div>
<label for='Sensor_lat'>Sensor lat</label>
<div class='row'><button type='button' onclick='handleButton("Sensor_lat")'>HÃ¤mta latitud</button>
<input type='text' class='important' id='Sensor_lat' name='Sensor_lat'></div>
</div>
<div>
<label for='Sensor_lon'>Sensor lon</label>
<div class='row'><button type='button' onclick='handleButton("Sensor_lon")'>HÃ¤mta longitud</button>
<input type='text' class='important' id='Sensor_lon' name='Sensor_lon'></div>
</div>
<div>
<label for='Ship_solo'>Ship solo</label>
<select class='important' id='Ship_solo' name='Ship_solo'>
<option value=''>VÃ¤lj</option>
<option value='Yes'>Yes</option>
<option value='No'>No</option>
</select>
</div>
<div>
<label for='Range_meter'>Range meter</label>
<select class='important' id='Range_meter' name='Range_meter'>
<option value=''>VÃ¤lj</option>
<option value='0-25'>0-25</option>
<option value='25-50'>25-50</option>
<option value='50-100'>50-100</option>
<option value='100-200'>100-200</option>
<option value='200-500'>200-500</option>
<option value='500+'>500+</option>
</select>
</div>
<div>
<label for='Ship_speed_kn'>Ship speed kn</label>
<select class='important' id='Ship_speed_kn' name='Ship_speed_kn'>
<option value=''>VÃ¤lj</option>
<option value='0-5'>0-5</option>
<option value='5-10'>5-10</option>
<option value='10-15'>10-15</option>
<option value='15-20'>15-20</option>
<option value='20-30'>20-30</option>
<option value='30+'>30+</option>
</select>
</div>
<div>
<label for='Ship_course_deg'>Ship course deg</label>
<select id='Ship_course_deg' name='Ship_course_deg'>
<option value=''>VÃ¤lj</option>
<option value='0-90'>0-90</option>
<option value='90-180'>90-180</option>
<option value='180-270'>180-270</option>
<option value='270-360'>270-360</option>
</select>
</div>
<div>
<label for='Bearing_deg'>Bearing deg</label>
<select id='Bearing_deg' name='Bearing_deg'>
<option value=''>VÃ¤lj</option>
<option value='0-90'>0-90</option>
<option value='90-180'>90-180</option>
<option value='180-270'>180-270</option>
<option value='270-360'>270-360</option>
</select>
</div>
<div class='section'><h3>Shipdata</h3>
<div>
<label for='AIS_track'>AIS track</label>
<select class='important' id='AIS_track' name='AIS_track'>
<option value=''>VÃ¤lj</option>
<option value='Yes'>Yes</option>
<option value='No'>No</option>
</select>
</div>
<div>
<label for='Ship_type'>Ship type</label>
<select class='important' id='Ship_type' name='Ship_type'>
<option value=''>VÃ¤lj</option>
<option value='Leisure_engine'>Leisure_engine</option>
<option value='Leisure_sail'>Leisure_sail</option>
<option value='Passenger'>Passenger</option>
<option value='Cargo'>Cargo</option>
<option value='Jetski'>Jetski</option>
<option value='SAR'>SAR</option>
<option value='Mil'>Mil</option>
<option value='Gov'>Gov</option>
<option value='Other'>Other</option>
</select>
</div>
<div>
<label for='Engine_type'>Engine type</label>
<select class='important' id='Engine_type' name='Engine_type'>
<option value=''>VÃ¤lj</option>
<option value='Outboard'>Outboard</option>
<option value='Inboard'>Inboard</option>
<option value='Marine ("diesel")'>Marine ("diesel")</option>
<option value='Steam'>Steam</option>
<option value='Turbine'>Turbine</option>
<option value='Electric'>Electric</option>
<option value='Sail'>Sail</option>
<option value='Other'>Other</option>
</select>
</div>
<div>
<label for='Lenght_m'>Lenght m</label>
<select class='important' id='Lenght_m' name='Lenght_m'>
<option value=''>VÃ¤lj</option>
<option value='0-5'>0-5</option>
<option value='5-7'>5-7</option>
<option value='7-10'>7-10</option>
<option value='10-15'>10-15</option>
<option value='15-25'>15-25</option>
<option value='25-50'>25-50</option>
<option value='50-100'>50-100</option>
<option value='100+'>100+</option>
</select>
</div>
<div>
<label for='Width_m'>Width m</label>
<select id='Width_m' name='Width_m'>
<option value=''>VÃ¤lj</option>
<option value='0-2'>0-2</option>
<option value='2-4'>2-4</option>
<option value='4-10'>4-10</option>
<option value='10+'>10+</option>
</select>
</div>
<div>
<label for='Model'>Model</label>
<input type='text' id='Model' name='Model'>
</div>
<div>
<label for='MMSI'>MMSI</label>
<input type='text' id='MMSI' name='MMSI'>
</div>
<div>
<label for='Name'>Name</label>
<input type='text' id='Name' name='Name'>
</div>
<div>
<label for='Id'>Id</label>
<input type='text' id='Id' name='Id'>
</div>
<div>
<label for='Comments'>Comments</label>
<input type='text' id='Comments' name='Comments'>
</div>
</div><button type='submit'>Skicka</button></form>

<script>
function handleButton(field) {
  if (field === "TCPA_datetime") {
    const now = new Date();
    const pad = (n) => n.toString().padStart(2, '0');
    const datetime = now.getFullYear() + pad(now.getMonth()+1) + pad(now.getDate()) + "_" + pad(now.getHours()) + pad(now.getMinutes()) + pad(now.getSeconds());
    document.getElementById(field).value = datetime;
  } else if (field === "Sensor_lat" || field === "Sensor_lon") {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((pos) => {
        document.getElementById("Sensor_lat").value = pos.coords.latitude.toFixed(6);
        document.getElementById("Sensor_lon").value = pos.coords.longitude.toFixed(6);
      }, (err) => {
        alert("Kunde inte hÃ¤mta position: " + err.message);
      });
    } else {
      alert("Geolocation stÃ¶ds inte.");
    }
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const now = new Date();
  const pad = (n) => n.toString().padStart(2, '0');
  const datetime = now.getFullYear() + pad(now.getMonth()+1) + pad(now.getDate()) + "_" + pad(now.getHours()) + pad(now.getMinutes()) + pad(now.getSeconds());
  document.getElementById("Report_datetime").value = datetime;

  document.getElementById("boatForm").addEventListener("submit", (e) => {
    e.preventDefault();
    alert("ðŸš§ CSV-export Ã¤nnu inte inkopplad.");
  });
});


<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
function handleButton(field) {
  if (field === "TCPA_datetime") {
    const now = new Date();
    const pad = (n) => n.toString().padStart(2, '0');
    const datetime = now.getFullYear() + pad(now.getMonth()+1) + pad(now.getDate()) + "_" +
                     pad(now.getHours()) + pad(now.getMinutes()) + pad(now.getSeconds());
    document.getElementById(field).value = datetime;
  } else if (field === "Sensor_lat" || field === "Sensor_lon") {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((pos) => {
        document.getElementById("Sensor_lat").value = pos.coords.latitude.toFixed(6);
        document.getElementById("Sensor_lon").value = pos.coords.longitude.toFixed(6);
      }, (err) => {
        alert("Kunde inte hÃ¤mta position: " + err.message);
      });
    } else {
      alert("Geolocation stÃ¶ds inte.");
    }
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const now = new Date();
  const pad = (n) => n.toString().padStart(2, '0');
  const datetime = now.getFullYear() + pad(now.getMonth()+1) + pad(now.getDate()) + "_" +
                   pad(now.getHours()) + pad(now.getMinutes()) + pad(now.getSeconds());
  document.getElementById("Report_datetime").value = datetime;

  document.getElementById("boatForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const fields = Array.from(document.querySelectorAll("input, select"));
    const data = {};
    fields.forEach(field => {
      if (field.type === "file") return;
      data[field.name] = field.value.trim();
    });

    const lines = [];
    for (const [key, val] of Object.entries(data)) {
      lines.push(`${key};${val}`);
    }
    const csvContent = lines.join("\n");

    const lat = data["Sensor_lat"] || "";
    const lon = data["Sensor_lon"] || "";
    const mmsi = data["MMSI"] || "";
    const name = data["Name"] || "";
    const dt = data["Report_datetime"] || datetime;
    const fname = "boat_" + dt.replaceAll(":", "").replaceAll("-", "") +
                  (lat && lon ? `_${lat}_${lon}` : "") +
                  (mmsi ? `_${mmsi}` : "") +
                  (!mmsi && name ? `_${name}` : "");

    const zip = new JSZip();
    const csvBlob = new Blob([csvContent], { type: "text/csv" });
    zip.file(fname + ".csv", csvBlob);

    const fileInput = document.querySelector('input[type="file"]');
    const file = fileInput?.files?.[0];
    if (file) {
      zip.file(fname + ".jpg", file);
    }

    const content = await zip.generateAsync({ type: "blob" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(content);
    a.download = fname + ".zip";
    a.click();
  });
});
</script>
</body></html>